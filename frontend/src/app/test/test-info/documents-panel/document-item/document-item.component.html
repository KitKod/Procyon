<mat-expansion-panel>
    <mat-expansion-panel-header>
        <mat-panel-title class="self-center">{{ title }}</mat-panel-title>
        <mat-panel-description>
            <span class="flex-1"></span>
            <div
                *ngIf="document.status || 'developing' as testStatus"
                class="rounded-full my-1 py-1 px-2 font-medium"
                [ngClass]="{
                    'bg-gray-200': ['developing'].includes(testStatus),
                    'bg-yellow-300': ['approving'].includes(testStatus),
                    'bg-green-400': ['approved'].includes(testStatus),
                    'text-white': ['approved'].includes(testStatus)
                }"
                (click.stop)="(null)"
            >
                {{ testStatus }}
                <span *ngIf="document.date_of_approval">/ {{ document.date_of_approval }}</span>
            </div>
        </mat-panel-description>
    </mat-expansion-panel-header>

    <div class="flex flex-col md:flex-row gap-4 md:items-baseline">
        <mat-form-field *ngIf="!document.name; else docPreview" appearance="standard">
            <mat-label>Upload document</mat-label>
            <input matInput required readonly [value]="''" />
            <input #fileUpload class="hidden" type="file" (change)="$any($event.target).files[0]" />

            <button mat-icon-button color="primary" matSuffix (click)="fileUpload.click()">
                <mat-icon>upload</mat-icon>
            </button>
        </mat-form-field>

        <mat-form-field appearance="standard">
            <mat-label>Government</mat-label>
            <input matInput disabled required [value]="document.government" />
        </mat-form-field>

        <div class="flex-1"></div>

        <div class="flex md:flex-row flex-col gap-4">
            <button mat-icon-button [matMenuTriggerFor]="menu"><mat-icon>more_vert</mat-icon></button>
            <mat-menu #menu="matMenu">
                <button
                    *ngIf="document.status === 'developing'"
                    mat-menu-item
                    [disabled]="!document.name || !document.government"
                    (click)="changeDocumentStatus(document, 'approving')"
                >
                    Start approving
                </button>
                <button
                    *ngIf="document.status === 'approving' || document.status === 'approved'"
                    mat-menu-item
                    [disabled]="!document.name || !document.government"
                    (click)="changeDocumentStatus(document, 'developing')"
                >
                    For revision
                </button>
                <button
                    *ngIf="document.status === 'approved'"
                    mat-menu-item
                    [disabled]="!document.name || !document.government"
                    (click)="changeDocumentStatus(document, 'developing')"
                >
                    Reapprove
                </button>
                <button
                    *ngIf="document.status === 'approving'"
                    mat-menu-item
                    [disabled]="!document.name || !document.government"
                    (click)="changeDocumentStatus(document, 'approved')"
                >
                    Approve
                </button>
            </mat-menu>
        </div>
    </div>

    <ng-template #docPreview>
        <div class="text-blue-700 flex cursor-pointer align-start 2xl:self-center">
            <mat-icon>file_present</mat-icon>
            <span class="font-bold self-end">{{ document.name }}</span>
        </div>
    </ng-template>
</mat-expansion-panel>
